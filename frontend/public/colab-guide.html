<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Colab é›²ç«¯åŠ é€ŸæŒ‡å—</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #1a1a2e;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .badge-gpu {
            display: inline-block;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #000;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.4);
        }

        /* Steps Container */
        .steps {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .steps {
                grid-template-columns: 1fr;
            }
        }

        /* Step Card */
        .step-card {
            background: white;
            border-radius: 20px;
            padding: 28px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
        }

        .step-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 20px;
            width: fit-content;
        }

        .step-badge.step-1 {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .step-badge.step-2 {
            background: #dcfce7;
            color: #16a34a;
        }

        .step-badge.step-3 {
            background: #f3e8ff;
            color: #9333ea;
        }

        .step-content {
            flex: 1;
            margin-bottom: 24px;
        }

        .step-content h3 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #111827;
            margin-bottom: 12px;
        }

        .step-content p {
            font-size: 0.95rem;
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        .step-content ul {
            list-style: none;
            padding: 0;
            margin: 16px 0 0;
        }

        .step-content li {
            font-size: 0.9rem;
            color: #374151;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-content li::before {
            content: "âœ…";
        }

        .code-block {
            display: inline-block;
            font-family: 'Consolas', 'Monaco', monospace;
            background: linear-gradient(135deg, #1e293b, #334155);
            color: #fbbf24;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .tip-box {
            margin-top: 16px;
            padding: 14px;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
            border-radius: 10px;
        }

        .tip-box p {
            font-size: 0.85rem;
            color: #92400e;
            font-weight: 500;
            margin: 0;
        }

        /* Buttons */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 14px 20px;
            font-size: 0.95rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            border: none;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
        }

        .btn-outline {
            background: white;
            color: #374151;
            border: 2px solid #e5e7eb;
        }

        .btn-outline:hover {
            border-color: #3b82f6;
            color: #2563eb;
        }

        .btn-group {
            display: flex;
            gap: 12px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* Footer */
        .footer {
            text-align: center;
            color: white;
            opacity: 0.8;
        }

        .footer p {
            font-size: 0.9rem;
        }

        .footer a {
            color: white;
            text-decoration: underline;
        }

        /* Warning Box */
        .warning-text {
            color: #dc2626;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                ğŸš€ Google Colab é›²ç«¯åŠ é€Ÿ
                <span class="badge-gpu">å…è²» GPU</span>
            </h1>
            <p>ä½¿ç”¨ Google å…è²» T4 GPUï¼Œå½±ç‰‡ç”Ÿæˆé€Ÿåº¦æå‡ 10 å€ï¼</p>
        </div>

        <!-- Steps -->
        <div class="steps">
            <!-- Step 1 -->
            <div class="step-card">
                <span class="step-badge step-1">Step 1: æº–å‚™</span>
                <div class="step-content">
                    <h3>é›²ç«¯ç¡¬ç¢Ÿå»ºç«‹è³‡æ–™å¤¾</h3>
                    <div class="code-block">PPT_AI_Project/backend</div>
                    <p style="margin-top: 16px;">ä¸Šå‚³ä»¥ä¸‹æª”æ¡ˆï¼ˆä¸ç”¨å‚³ checkpointsï¼‰ï¼š</p>
                    <ul>
                        <li>app/ è³‡æ–™å¤¾</li>
                        <li>requirements.txt</li>
                        <li>outputs/ & uploads/</li>
                    </ul>
                </div>
                <a href="https://drive.google.com/" target="_blank" class="btn btn-primary">
                    ğŸ“‚ é–‹å•Ÿ Google Drive
                </a>
            </div>

            <!-- Step 2 -->
            <div class="step-card">
                <span class="step-badge step-2">Step 2: åŸ·è¡Œ</span>
                <div class="step-content">
                    <h3>åŸ·è¡ŒåŠ é€Ÿè…³æœ¬</h3>
                    <p>ç´„éœ€ 3-5 åˆ†é˜å®Œæˆåˆå§‹åŒ–</p>
                    <p>è²¼ä¸Šç¨‹å¼ç¢¼ä¸¦é»æ“Šã€Œå…¨éƒ¨åŸ·è¡Œã€</p>
                    <p class="warning-text">* ğŸ’¡ æŠ€å·§ï¼šæ”¹å®Œè¨­å®šè¦é‡æ–°è¤‡è£½ï¼</p>
                </div>
                <div class="btn-group">
                    <button class="btn btn-outline" onclick="copyScript()">
                        ğŸ“‹ è¤‡è£½è…³æœ¬
                    </button>
                    <a href="https://colab.research.google.com/" target="_blank" class="btn btn-primary">
                        ğŸ”¥ é–‹å•Ÿ Colab
                    </a>
                </div>
            </div>

            <!-- Step 3 -->
            <div class="step-card">
                <span class="step-badge step-3">Step 3: æ”¶å›</span>
                <div class="step-content">
                    <h3>å°‡çµæœä¸‹è¼‰å›æœ¬æ©Ÿ</h3>
                    <p>1. å¾ Drive ä¸‹è¼‰æ‰€æœ‰ <strong>.mp4</strong> æª”æ¡ˆ</p>
                    <p>2. æ”¾å…¥æœ¬æ©Ÿçš„ï¼š</p>
                    <div class="code-block">backend/outputs</div>
                    <p style="margin-top: 12px;">3. å›åˆ°æ‡‰ç”¨ç¨‹å¼é»æ“Šã€Œæ›´æ–° PPTã€</p>
                    <div class="tip-box">
                        <p>ğŸ’¡ <strong>æ–¹å½¢å½±ç‰‡æ˜¯æ­£å¸¸çš„ï¼</strong> æ”¾å…¥ PPT å¾Œæœƒè‡ªå‹•è®Šæˆåœ“å½¢é®ç½©ã€‚</p>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="window.close()">
                    âœ… å®Œæˆï¼Œé—œé–‰è¦–çª—
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>å®Œæˆä¸Šè¿°æ­¥é©Ÿå¾Œï¼Œå›åˆ°ä¸»æ‡‰ç”¨ç¨‹å¼ç¹¼çºŒæ“ä½œ</p>
        </div>
    </div>

    <script>
        function copyScript() {
            const script = `# ğŸš€ Google Colab åŠ é€Ÿè…³æœ¬
# ==========================================
from google.colab import drive
import os, shutil, sys

# 1. æ›è¼‰é›²ç«¯ç¡¬ç¢Ÿ
drive.mount('/content/drive')
DRIVE_ROOT = "/content/drive/MyDrive/PPT_AI_Project/backend"

print("ğŸš€ [1/6] åˆå§‹åŒ–ç’°å¢ƒ...")
if not os.path.exists(DRIVE_ROOT):
    print(f"âŒ æ‰¾ä¸åˆ°è·¯å¾‘ {DRIVE_ROOT}")
    sys.exit(1)

# è¤‡è£½ç¨‹å¼ç¢¼
if not os.path.exists("/content/app"):
    shutil.copytree(f"{DRIVE_ROOT}/app", "/content/app")
    shutil.copy(f"{DRIVE_ROOT}/requirements.txt", "/content/")

# 2. å®‰è£ä¾è³´
print("ğŸ“¦ [2/6] å®‰è£ AI å¥—ä»¶...")
os.chdir("/content")
!pip install -q -r requirements.txt
!apt-get install -y ffmpeg > /dev/null

# 3. ä¸‹è¼‰æ¨¡å‹ï¼ˆå¦‚æœéœ€è¦ï¼‰
CKPT_PATH = "/content/checkpoints"
if not os.path.exists(CKPT_PATH):
    print("â¬‡ï¸ [3/6] ä¸‹è¼‰æ¨¡å‹...")
    !git lfs install
    !git clone https://huggingface.co/digital-avatar/ditto-talkinghead checkpoints

# 4. æº–å‚™ç”Ÿæˆ
print("ğŸ¬ [4/6] æº–å‚™ç”Ÿæˆ...")
sys.path.append("/content")
from app.services.avatar_service import AvatarService

AUDIO_DIR = f"{DRIVE_ROOT}/outputs"
UPLOAD_DIR = f"{DRIVE_ROOT}/uploads"

mp3_files = sorted([f for f in os.listdir(AUDIO_DIR) if f.endswith(".mp3") and "slide_" in f])
image_path = None
for f in os.listdir(UPLOAD_DIR):
    if f.lower().endswith(('.png', '.jpg', '.jpeg', '.webp')):
        image_path = os.path.join(UPLOAD_DIR, f)
        break

print(f"ğŸ‘¤ é ­åƒ: {os.path.basename(image_path)}")
print(f"ğŸ“‚ éŸ³æª”: {len(mp3_files)} å€‹")

# 5. é–‹å§‹ç”Ÿæˆ
async def main():
    service = AvatarService()
    print("âš¡ï¸ [5/6] é–‹å§‹ç”Ÿæˆ...")
    for mp3 in mp3_files:
        out_name = mp3.replace(".mp3", ".mp4")
        out_path = os.path.join(AUDIO_DIR, out_name)
        if os.path.exists(out_path) and os.path.getsize(out_path) > 100000:
            print(f"â­ï¸ è·³é: {out_name}")
            continue
        print(f"ğŸ“½ï¸ ç”Ÿæˆ: {out_name}")
        await service.generate_talking_head(
            image_path=image_path,
            audio_path=os.path.join(AUDIO_DIR, mp3),
            output_path=out_path,
            options={"crop_scale": 2.5, "emotion": 4}
        )
        print(f"âœ… å®Œæˆ: {out_name}")

await main()
print("ğŸ‰ [6/6] å…¨éƒ¨å®Œæˆï¼è«‹å› Drive ä¸‹è¼‰ .mp4 æª”æ¡ˆã€‚")
`;
            navigator.clipboard.writeText(script).then(() => {
                alert('âœ… è…³æœ¬å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼\\n\\nè«‹è²¼åˆ° Google Colab ä¸¦åŸ·è¡Œã€‚');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
            });
        }
    </script>
</body>

</html>