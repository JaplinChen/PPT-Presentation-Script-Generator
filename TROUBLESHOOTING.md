# Gemini API 配額問題終極解決方案

## 當前狀況

您遇到的 **429 Quota Exceeded** 錯誤是 Google Gemini API 免費方案的硬性限制：
- **每分鐘最多 5 次請求**
- **每天最多 1500 次請求**  
- 超過後需等待 1 分鐘才能重置

## 🚨 立即可用的解決方案

###  方案1：等待配額重置（免費但需等待）

**步驟：**
1. **等待 2-3 分鐘**（讓配額完全重置）
2. 重新刷新前端頁面
3. 再次嘗試生成文稿

**優點：** 免費  
**缺點：** 需要等待

---

### ⭐ 方案 2：手動重啟後端（確保程式碼更新）

**步驟：**
1. 在後端終端按 `Ctrl+C` 停止伺服器
2. 等待 2 分鐘（配額重置）
3. 重新啟動：
   ```bash
   cd backend
   python -m uvicorn app.main:app --reload --port 8000
   ```
4. 確認看到 "✅ Script generator initialized successfully"
5. 重試生成文稿

**原因：** 確保優化後的程式碼（單次 API 調用）真正生效

---

### 💰 方案 3：升級到付費方案（永久解決）

訪問 Google AI Studio 並升級：
- URL: https://aistudio.google.com/app/apikey
- 選擇 "Pay as you go"
- 費用非常低（每 100 萬 tokens 約 $0.35）
- **無每分鐘限制**

**優點：** 完全解決配額問題  
**缺點：** 需要信用卡

---

### 🧪 方案 4：使用測試 PPT（減少內容）

**步驟：**
1. 建立只有 **3-5 頁**的簡單 PPT
2. 每頁內容簡短（2-3 個要點）
3. 上傳並測試

**原因：** 即使優化後，超大 PPT 產生的 Prompt 可能仍然觸發配額

---

### 🔧 方案 5：使用本地模型（完全離線）

**替代方案：**
- 使用 Ollama + Llama 3 等開源模型
- 完全離線運行
- 無配額限制

**缺點：** 需要較強的硬體（GPU）且設置複雜

---

## 🎯 建議的完整流程

### 立即測試（5 分鐘內）

1. **等待 2 分鐘**讓配額重置
2. **手動重啟後端**：
   ```bash
   # 在後端終端按 Ctrl+C
   # 然後重新執行：
   python -m uvicorn app.main:app --reload --port 8000
   ```
3. **建立簡單測試 PPT**（只有 3 頁）：
   - 第 1 頁：標題頁
   - 第 2 頁：主要內容（2-3 點）
   - 第 3 頁：結論
4. **重試生成**

### 長期解決

如果經常使用此應用：
- ✅ **升級到付費 API**（最推薦）
- 或每天限制使用次數（免費方案每天 1500 次）

---

## 📊 配額使用情況查詢

查看您當前的配額狀態：
1. 訪問：https://aistudio.google.com/
2. 點擊右上角頭像
3. 選擇 "API Keys"
4. 查看 "Usage" 頁面

---

## ⚠️ 重要提醒

**優化後的程式碼已就緒**，但由於之前的多次調用已經耗盡配額，您需要：
1. 等待配額重置
2. 手動重啟後端確保新程式碼生效
3. 使用小型 PPT 測試

**優化效果：**
- 之前：13 頁 PPT = **26 次 API 調用** ❌
- 現在：13 頁 PPT = **1 次 API 調用** ✅

---

## 🆘 如果仍然失敗

請執行以下測試腳本確認 API 可用性：
```bash
cd backend
python test_gemini.py
```

這會告訴您：
- API Key 是否有效
- 當前可用的模型
- 是否超過配額
